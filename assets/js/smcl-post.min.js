/**
 * Convert styles attributes to class attributes
 * @author Simon Jan
 * @link https://profiles.wordpress.org/simonjan
 * @license http://www.gnu.org/licenses/gpl-3.0.html GLv3 or later                                                                                                                  [description]
 */
!function(t,e,n){var s=[],a={},r={},l="",o={color:"color:#",align:"text-align:",padding:"padding-left:",decoration:"text-decoration:",transform:"text-transform:",top:"margin-top:",size:"font-size:",family:"font-family:",em:"font-style:",strong:"font-weight:"},c=i=0,m={init:function(){var e=n("#smcl-optimize");m.app(),c?e.addClass("sm-warning"):e.removeClass("sm-warning"),e.on("click",function(e){if(e.preventDefault(),confirm("Are you sure?")){var s=n("#smcl-editor-post").text(),a={action:"sm-act_compress",content:s};m.post(a).done(function(e){e&&t.location.reload()})}})},app:function(){c=0;var e=n("#content"),i=n("<div/>",{id:"smcl-content","class":"hidden"}),r="",_="</?(";if(e.length>0){r=e.text(),n.isEmptyObject(_SMCLSetting_.list_include)||(n.each(_SMCLSetting_.list_include,function(t,e){e=e.toLowerCase(),_+=e+"|"}),_=_.substring(0,_.length-1),_+=")>",_=new RegExp(_,"gi"),r=r.replace(_,function(t){return"<em>"==t?(nameClass=_SMCLSetting_.class_name.size+"italic",-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=o.em+"italic"),'<span class="'+nameClass+'">'):"<strong>"==t?(nameClass=_SMCLSetting_.class_name.size+"bold",-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=o.strong+"bold"),'<span class="'+nameClass+'">'):"<del>"==t?(nameClass=_SMCLSetting_.class_name.decoration+"line-through",-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=o.decoration+"line-through"),'<span class="'+nameClass+'">'):"</span>"})),i.append(r).appendTo("body");i.find(" > *").each(function(){m.removeSpace(n(this),_SMCLSetting_.edit_margin,!1)}),r=i.html(),n("#smcl-editor-post").empty().html(r),n.each(a,function(t,e){l+="."+t+"{"+e+"}"});var p={action:"sm-act_create_css",post:_SMCLSetting_.id,clas:a,content:r,nonce:_SMCLSetting_.sm_nonce};n.post(_SMCLSetting_.ajax_url,p,function(e){e&&("updated"==e?t.location.reload():"errors"==e&&alert("Sorry, We can't create new file. Please go to setting to copy your style or go to directory this plugin and check the permissions, thanks!"),n("#smcl-editor-css").html(l))})}},changeContent:function(t,e,l){if(e){var _=t.find(" > *").length,p=t.context.style.cssText,d=t.context.className,g=0,u=t.context.tagName,f=name_class="";t.find("> *").each(function(){var t=n(this).context.attributes;t.style&&g++});var h={color:p.match(/color:\s*rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*;/i),align:p.match(/text-align:\s*(left|right|justify|center|nowrap);/i),padding:p.match(/padding-left:\s*([0-9]+)px;/i),decoration:p.match(/text-decoration:\s*(underline|overline|line-through);/i),transform:p.match(/text-transform:\s*(uppercase|lowercase|capitalize);/i),family:p.match(/font-family:\s([\w,'\- ]+);/i),size:p.match(/font-size:\s*(\d+)pt;/i),empty:1==(l&&0==g&&"TBODY"!=u&&"TR"!=u&&-1==n.inArray(u,_SMCLSetting_.list_exclude)&&t.parent().text().trim()==t.text().trim())?!0:null};for(k in h)null==h[k]?delete h[k]:"empty"==k&&c++;if(!n.isEmptyObject(h))for(k in h){if("empty"!=k&&(p=p.replace(h[k][0],""),!_SMCLSetting_.class_name[k]))return;switch(k){case"empty":t.parent().addClass(t.attr("class")),t.parent().text(t.html());break;default:if(f=m.renderStyle(h,k),d.length>0&&-1!=d.indexOf(_SMCLSetting_.class_name[k])){var S="\\s*("+_SMCLSetting_.class_name[k]+")([\\w-]+)",S=new RegExp(S,"gi");console.log(S),d=d.replace(S,function(t,e){return class_name=e+f[0],-1==n.inArray(class_name,s)&&(s.push(class_name),a[class_name]=o[k]+f[1]),class_name}),t.attr("class",d)}else name_class=_SMCLSetting_.class_name[k]+f[0],t.addClass(name_class),-1==n.inArray(name_class,s)&&(s.push(name_class),a[name_class]=o[k]+f[1])}}if(1==_SMCLSetting_.edit_margin&&!n.isEmptyObject(r)){var C=0;for(k in r)C+=r[k]*_SMCLSetting_.sm_margin[k],delete r[k];if(C)if(d.length>0&&-1!=d.indexOf(_SMCLSetting_.class_name.top)){var S="\\s*("+_SMCLSetting_.class_name.top+")(\\d+)",S=new RegExp(S,"gi");d=d.replace(S,function(t,e,i){return C=parseInt(i)+C,class_name=e+C,-1==n.inArray(class_name,s)&&(s.push(class_name),a[class_name]=o.top+C+"px"),class_name}),t.attr("class",d)}else nameClass=_SMCLSetting_.class_name.top+C,t.addClass(nameClass),-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=o.top+C+"px")}p=n.trim(p),p.length>0?t.attr("style",p):t.removeAttr("style"),_>0&&t.find(" > * ").each(function(){t.find(" > *").length;m.removeSpace(n(this),_SMCLSetting_.edit_margin,!0)}),i=0}else{var y="-P-H1-H2-H3-H4-H5-",u=t.context.tagName;if("IMG"!=u&&-1!=y.indexOf("-"+u+"-")&&(r[u]=void 0!=r[u]?++r[u]:1),0!=_SMCLSetting_.edit_margin&&"IMG"!=u){if("TD"==u){var x=0;t.prev("td")?(x=t.prev("td").attr("colspan"),x=x?++x:2,t.prev("td").attr("colspan",x)):t.next("td")&&(x=t.next("td").attr("colspan"),x=x?++x:2,t.next("td").attr("colspan",x))}t.remove()}i++}},rgb2hex:function(t,e,n){var s=m.cpToHex(t)+m.cpToHex(e)+m.cpToHex(n),a=s.match(/(\w)\1(\w)\2(\w)\3$/);return null!=a&&(s=a[1]+a[2]+a[3]),s},cpToHex:function(t){var e=parseInt(t,10).toString(16);return 1==e.length?"0"+e:e},post:function(t){var e={post:_SMCLSetting_.id,nonce:_SMCLSetting_.sm_nonce};return t=n.extend(e,t),n.post(_SMCLSetting_.ajax_url,t)},removeSpace:function(t,e,n){var s=t.html();return e&&(s=s.replace(/(\s+|&nbsp;)/gi,"")),m.changeContent(t,s,n)},renderFont:function(t){return t.substring(0,3)},renderStyle:function(t,e){switch(e){case"color":return sm_style=m.rgb2hex(t[e][1],t[e][2],t[e][3]),{0:sm_style,1:sm_style};case"padding":return{0:t[e][1],1:t[e][1]+"px"};case"family":return sm_style=t[e][1].replace(/ |\'/g,""),sm_style=sm_style.split(","),sm_style=sm_style.sort().map(m.renderFont).join("-"),{0:sm_style,1:t[e][1]+"!important"};case"size":return sm_style=t[e][1],sm_style=Math.floor(4/3*sm_style),{0:sm_style,1:t[e][1]+"px"};default:return{0:t[e][1],1:t[e][1]}}}};m.init()}(window,document,window.jQuery);