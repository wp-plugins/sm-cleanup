/**
 * Convert styles attributes to class attributes
 * @author Simon Jan
 * @link https://profiles.wordpress.org/simonjan
 * @license http://www.gnu.org/licenses/gpl-3.0.html GLv3 or later                                                                                                                  [description]
 */
!function(e,t,n){var s=[],a={},r={},l={color:"color:#",align:"text-align:",padding:"padding-left:",decoration:"text-decoration:",transform:"text-transform:",top:"margin-top:",size:"font-size:",family:"font-family:",height:"height:",width:"width:",em:"font-style:",strong:"font-weight:"},c=["TBODY","TR","DIV"],o=i=0;_SMCLSetting_.list_exclude=_SMCLSetting_.list_exclude.concat(c);var m={init:function(){var t=n("#smcl-optimize");m.app(),o?t.removeClass("sm-success").addClass("sm-warning").next("p").fadeIn():(t.removeClass("sm-warning").next("p").hide(),""!=n("#content").text()&&n.isEmptyObject(a)&&t.addClass("sm-success")),t.on("click",function(t){if(t.preventDefault(),confirm("Are you sure?")){var s=n("#smcl-editor-post").text(),a={action:"sm-act_compress",content:s};m.post(a).done(function(t){t&&e.location.reload()})}})},app:function(){o=0;var t=n("#content"),i=n("<div/>",{id:"smcl-content","class":"hidden"}),r="",c="</?(";if(t.length>0){r=t.text(),n.isEmptyObject(_SMCLSetting_.list_include)||(n.each(_SMCLSetting_.list_include,function(e,t){t=t.toLowerCase(),c+=t+"|"}),c=c.substring(0,c.length-1),c+=")>",c=new RegExp(c,"gi"),r=r.replace(c,function(e){return"<em>"==e?(nameClass="smcl-italic",-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=l.em+"italic"),'<span class="'+nameClass+'">'):"<strong>"==e?(nameClass="smcl-bold",-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=l.strong+"bold"),'<span class="'+nameClass+'">'):"<del>"==e?(nameClass=_SMCLSetting_.class_name.decoration+"line-through",-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=l.decoration+"line-through"),'<span class="'+nameClass+'">'):"</span>"})),i.append(r).appendTo("body");var p=cpstyle=origin=0;if(i.find(" > *").each(function(){m.removeSpace(n(this),_SMCLSetting_.edit_margin,!1)}),r=i.html(),p=m.fileSize(r),cpstyle=parseInt(n("#smcl-body-result").children("td").eq(2).text()),origin=parseInt(n("#smcl-body-result").children("td").eq(0).text()),n("#smcl-body-result").children("td").eq(1).text(p).next("td").next("td").text(origin-p).next("td").text(origin-p-cpstyle).next("td").text(10*(origin-p)-cpstyle).siblings("td").andSelf().not("td:eq(0)").append(" Bytes").closest("#smcl-result").slideDown(),n("#smcl-editor-post").empty().html(r),!n.isEmptyObject(a)){var d={action:"sm-act_create_css",post:_SMCLSetting_.id,clas:a,content:r,nonce:_SMCLSetting_.sm_nonce};n.post(_SMCLSetting_.ajax_url,d,function(t){t&&("updated"==t?e.location.reload():"errors"==t&&alert("Sorry, We can't create new file. Please go to setting to copy your style or go to directory this plugin and check the permissions, thanks!"))})}}},changeContent:function(e,t,c){if(t){var p=e.find(" > *").length,d=e.context.style.cssText,_=e.context.className,g=0,u=e.context.tagName,f=name_class="";e.find("> *").each(function(){var e=n(this).context.attributes;e.style&&g++});var h={bgk:d.match(/(background-color:)\s*rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*;/i),color:d.match(/(?:[^-]|^)(color:)\s*rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*;/i),align:d.match(/(text-align:)\s*(left|right|justify|center|nowrap);/i),padding:d.match(/(padding-left:)\s*([0-9]+)(px|em|rem|%);/i),decoration:d.match(/(text-decoration:)\s*(underline|overline|line-through);/i),transform:d.match(/(text-transform:)\s*(uppercase|lowercase|capitalize);/i),family:d.match(/(font-family:)\s([\w,'\- ]+);/i),size:d.match(/(font-size:)\s*(\d+)(pt|px|em|rem|%);/i),list_type:d.match(/(list-style-type:)\s*(circle|disc|square|lower-alpha|upper-alpha|lower-greek|lower-roman|upper-roman|none);/i),hei:d.match(/(height:)\s*(\d+)(px|em|rem|%);/i),wid:d.match(/(width:)\s*(\d+)(px|em|rem|%);/i),empty:1==(c&&0==g&&-1==n.inArray(u,_SMCLSetting_.list_exclude)&&e.parent().text().trim()==e.text().trim())?!0:null};for(k in h)null==h[k]?delete h[k]:"empty"==k&&o++;if(!n.isEmptyObject(h))for(k in h){if("empty"!=k&&(d=d.replace(h[k][0],""),!_SMCLSetting_.class_name[k]))return;switch(k){case"empty":name_class=m.uniqClass(e.attr("class"),e.parent().attr("class")),e.parent().attr("class",name_class),e.parent().text(e.html());break;default:if(f=m.renderStyle(h,k),_.length>0&&-1!=_.indexOf(_SMCLSetting_.class_name[k])){var y="("+_SMCLSetting_.class_name[k]+")([\\w-]+)",y=new RegExp(y,"gi");_=_.replace(y,function(e,t){return"align"==k&&f[0]==_SMCLSetting_.text?"":(name_class=t+f[0],-1==n.inArray(name_class,s)&&(s.push(name_class),a[name_class]=h[k][1]+f[1]),name_class)}),e.attr("class",_)}else("align"!=k||f[0]!=_SMCLSetting_.text)&&(name_class=_SMCLSetting_.class_name[k]+f[0],e.addClass(name_class),-1==n.inArray(name_class,s)&&(s.push(name_class),a[name_class]=h[k][1]+f[1]))}}if(1==_SMCLSetting_.edit_margin&&!n.isEmptyObject(r)){var x=0;for(k in r)x+=r[k]*_SMCLSetting_.sm_margin[k],delete r[k];if(x)if(_.length>0&&-1!=_.indexOf(_SMCLSetting_.class_name.top)){var y="("+_SMCLSetting_.class_name.top+")(\\d+)",y=new RegExp(y,"gi");_=_.replace(y,function(e,t,i){return x=parseInt(i)+x,class_name=t+x,-1==n.inArray(class_name,s)&&(s.push(class_name),a[class_name]=l.top+x+"px"),class_name}),e.attr("class",_)}else nameClass=_SMCLSetting_.class_name.top+x,e.addClass(nameClass),-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=l.top+x+"px")}d=n.trim(d),d.length>0?e.attr("style",d):e.removeAttr("style"),p>0&&e.find(" > * ").each(function(){e.find(" > *").length;m.removeSpace(n(this),_SMCLSetting_.edit_margin,!0)}),i=0}else{var S="-P-H1-H2-H3-H4-H5-",u=e.context.tagName;if("IMG"!=u&&-1!=S.indexOf("-"+u+"-")&&(r[u]=void 0!=r[u]?++r[u]:1),0!=_SMCLSetting_.edit_margin&&"IMG"!=u){if("TD"==u){var C=0;e.prev("td")?(C=e.prev("td").attr("colspan"),C=C?++C:2,e.prev("td").attr("colspan",C)):e.next("td")&&(C=e.next("td").attr("colspan"),C=C?++C:2,e.next("td").attr("colspan",C))}e.remove()}i++}},rgb2hex:function(e,t,n){var s=m.cpToHex(e)+m.cpToHex(t)+m.cpToHex(n),a=s.match(/(\w)\1(\w)\2(\w)\3$/);return null!=a&&(s=a[1]+a[2]+a[3]),s},cpToHex:function(e){var t=parseInt(e,10).toString(16);return 1==t.length?"0"+t:t},post:function(e){var t={post:_SMCLSetting_.id,nonce:_SMCLSetting_.sm_nonce};return e=n.extend(t,e),n.post(_SMCLSetting_.ajax_url,e)},removeSpace:function(e,t,n){var s=e.html();return t&&(s=s.replace(/(\s+|&nbsp;)/gi,"")),m.changeContent(e,s,n)},renderFont:function(e){return e.substring(0,3)},uniqClass:function(e,t){var s={},a="";return t&&0!=t.length?(t=t+" "+e,t=t.split(" "),n.each(t,function(e,t){var n=t.substring(0,t.lastIndexOf("-"));s[n]=t}),n.each(s,function(e,t){a+=" "+t}),a=a.trim()):e},fileSize:function(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)},renderStyle:function(e,t){switch(t){case"color":case"bgk":return sm_style=m.rgb2hex(e[t][2],e[t][3],e[t][4]),{0:sm_style,1:"#"+sm_style};case"padding":case"wid":case"hei":case"size":var n=pc=e[t][3];return sm_style=e[t][2],"%"==n?pc="pc":"px"==n&&(pc=""),{0:sm_style+pc,1:sm_style+n};case"family":return sm_style=e[t][2].replace(/ |\'/g,""),sm_style=sm_style.split(","),(-1!=sm_style.indexOf("sans-serif")||-1!=sm_style.indexOf("serif"))&&sm_style.pop(),sm_style=sm_style.sort().map(m.renderFont).join("-"),{0:sm_style,1:e[t][2]+"!important"};default:return{0:e[t][2],1:e[t][2]}}}};m.init()}(window,document,window.jQuery);