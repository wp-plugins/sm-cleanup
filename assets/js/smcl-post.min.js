/**
 * Convert styles attributes to class attributes
 * @author Simon Jan
 * @link https://profiles.wordpress.org/simonjan
 * @license http://www.gnu.org/licenses/gpl-3.0.html GLv3 or later                                                                                                                  [description]
 */
!function(t,e,n){var s=[],a={},r={},l={color:"color:#",align:"text-align:",padding:"padding-left:",decoration:"text-decoration:",transform:"text-transform:",top:"margin-top:",size:"font-size:",family:"font-family:",height:"height:",width:"width:",em:"font-style:",strong:"font-weight:"},c=i=0,o={init:function(){var e=n("#smcl-optimize");o.app(),c?e.removeClass("sm-success").addClass("sm-warning").next("p").fadeIn():(e.removeClass("sm-warning").next("p").hide(),""!=n("#content").text()&&n.isEmptyObject(a)&&e.addClass("sm-success")),e.on("click",function(e){if(e.preventDefault(),confirm("Are you sure?")){var s=n("#smcl-editor-post").text(),a={action:"sm-act_compress",content:s};o.post(a).done(function(e){e&&t.location.reload()})}})},app:function(){c=0;var e=n("#content"),i=n("<div/>",{id:"smcl-content","class":"hidden"}),r="",m="</?(";if(e.length>0){r=e.text(),n.isEmptyObject(_SMCLSetting_.list_include)||(n.each(_SMCLSetting_.list_include,function(t,e){e=e.toLowerCase(),m+=e+"|"}),m=m.substring(0,m.length-1),m+=")>",m=new RegExp(m,"gi"),r=r.replace(m,function(t){return"<em>"==t?(nameClass="smcl-italic",-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=l.em+"italic"),'<span class="'+nameClass+'">'):"<strong>"==t?(nameClass="smcl-bold",-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=l.strong+"bold"),'<span class="'+nameClass+'">'):"<del>"==t?(nameClass=_SMCLSetting_.class_name.decoration+"line-through",-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=l.decoration+"line-through"),'<span class="'+nameClass+'">'):"</span>"})),i.append(r).appendTo("body");var p=cpstyle=origin=0;if(i.find(" > *").each(function(){o.removeSpace(n(this),_SMCLSetting_.edit_margin,!1)}),r=i.html(),p=o.fileSize(r),cpstyle=parseInt(n("#smcl-body-result").children("td").eq(2).text()),origin=parseInt(n("#smcl-body-result").children("td").eq(0).text()),n("#smcl-body-result").children("td").eq(1).text(p).next("td").next("td").text(origin-p).next("td").text(origin-p-cpstyle).next("td").text(10*(origin-p)-cpstyle).siblings("td").andSelf().not("td:eq(0)").append(" Bytes").closest("#smcl-result").slideDown(),n("#smcl-editor-post").empty().html(r),!n.isEmptyObject(a)){var d={action:"sm-act_create_css",post:_SMCLSetting_.id,clas:a,content:r,nonce:_SMCLSetting_.sm_nonce};n.post(_SMCLSetting_.ajax_url,d,function(e){e&&("updated"==e?t.location.reload():"errors"==e&&alert("Sorry, We can't create new file. Please go to setting to copy your style or go to directory this plugin and check the permissions, thanks!"))})}}},changeContent:function(t,e,m){if(e){var p=t.find(" > *").length,d=t.context.style.cssText,_=t.context.className,g=0,u=t.context.tagName,f=name_class="";t.find("> *").each(function(){var t=n(this).context.attributes;t.style&&g++});var h={color:d.match(/color:\s*rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*;/i),align:d.match(/text-align:\s*(left|right|justify|center|nowrap);/i),padding:d.match(/padding-left:\s*([0-9]+)px;/i),decoration:d.match(/text-decoration:\s*(underline|overline|line-through);/i),transform:d.match(/text-transform:\s*(uppercase|lowercase|capitalize);/i),family:d.match(/font-family:\s([\w,'\- ]+);/i),size:d.match(/font-size:\s*(\d+)pt;/i),empty:1==(m&&0==g&&"TBODY"!=u&&"TR"!=u&&-1==n.inArray(u,_SMCLSetting_.list_exclude)&&t.parent().text().trim()==t.text().trim())?!0:null};for(k in h)null==h[k]?delete h[k]:"empty"==k&&c++;if(!n.isEmptyObject(h))for(k in h){if("empty"!=k&&(d=d.replace(h[k][0],""),!_SMCLSetting_.class_name[k]))return;switch(k){case"empty":name_class=o.uniqClass(t.attr("class"),t.parent().attr("class")),t.parent().attr("class",name_class),t.parent().text(t.html());break;default:if(f=o.renderStyle(h,k),_.length>0&&-1!=_.indexOf(_SMCLSetting_.class_name[k])){var y="("+_SMCLSetting_.class_name[k]+")([\\w-]+)",y=new RegExp(y,"gi");_=_.replace(y,function(t,e){return name_class=e+f[0],-1==n.inArray(name_class,s)&&(s.push(name_class),a[name_class]=l[k]+f[1]),name_class}),t.attr("class",_)}else name_class=_SMCLSetting_.class_name[k]+f[0],t.addClass(name_class),-1==n.inArray(name_class,s)&&(s.push(name_class),a[name_class]=l[k]+f[1])}}if(1==_SMCLSetting_.edit_margin&&!n.isEmptyObject(r)){var x=0;for(k in r)x+=r[k]*_SMCLSetting_.sm_margin[k],delete r[k];if(x)if(_.length>0&&-1!=_.indexOf(_SMCLSetting_.class_name.top)){var y="("+_SMCLSetting_.class_name.top+")(\\d+)",y=new RegExp(y,"gi");_=_.replace(y,function(t,e,i){return x=parseInt(i)+x,class_name=e+x,-1==n.inArray(class_name,s)&&(s.push(class_name),a[class_name]=l.top+x+"px"),class_name}),t.attr("class",_)}else nameClass=_SMCLSetting_.class_name.top+x,t.addClass(nameClass),-1==n.inArray(nameClass,s)&&(s.push(nameClass),a[nameClass]=l.top+x+"px")}d=n.trim(d),d.length>0?t.attr("style",d):t.removeAttr("style"),p>0&&t.find(" > * ").each(function(){t.find(" > *").length;o.removeSpace(n(this),_SMCLSetting_.edit_margin,!0)}),i=0}else{var C="-P-H1-H2-H3-H4-H5-",u=t.context.tagName;if("IMG"!=u&&-1!=C.indexOf("-"+u+"-")&&(r[u]=void 0!=r[u]?++r[u]:1),0!=_SMCLSetting_.edit_margin&&"IMG"!=u){if("TD"==u){var S=0;t.prev("td")?(S=t.prev("td").attr("colspan"),S=S?++S:2,t.prev("td").attr("colspan",S)):t.next("td")&&(S=t.next("td").attr("colspan"),S=S?++S:2,t.next("td").attr("colspan",S))}t.remove()}i++}},rgb2hex:function(t,e,n){var s=o.cpToHex(t)+o.cpToHex(e)+o.cpToHex(n),a=s.match(/(\w)\1(\w)\2(\w)\3$/);return null!=a&&(s=a[1]+a[2]+a[3]),s},cpToHex:function(t){var e=parseInt(t,10).toString(16);return 1==e.length?"0"+e:e},post:function(t){var e={post:_SMCLSetting_.id,nonce:_SMCLSetting_.sm_nonce};return t=n.extend(e,t),n.post(_SMCLSetting_.ajax_url,t)},removeSpace:function(t,e,n){var s=t.html();return e&&(s=s.replace(/(\s+|&nbsp;)/gi,"")),o.changeContent(t,s,n)},renderFont:function(t){return t.substring(0,3)},uniqClass:function(t,e){var s={},a="";return e&&0!=e.length?(e=e+" "+t,e=e.split(" "),n.each(e,function(t,e){var n=e.substring(0,e.lastIndexOf("-"));s[n]=e}),n.each(s,function(t,e){a+=" "+e}),a=a.trim()):t},fileSize:function(t){var e=encodeURIComponent(t).match(/%[89ABab]/g);return t.length+(e?e.length:0)},renderStyle:function(t,e){switch(e){case"color":return sm_style=o.rgb2hex(t[e][1],t[e][2],t[e][3]),{0:sm_style,1:sm_style};case"padding":return{0:t[e][1],1:t[e][1]+"px"};case"family":return sm_style=t[e][1].replace(/ |\'/g,""),sm_style=sm_style.split(","),(-1!=sm_style.indexOf("sans-serif")||-1!=sm_style.indexOf("serif"))&&sm_style.pop(),sm_style=sm_style.sort().map(o.renderFont).join("-"),{0:sm_style,1:t[e][1]+"!important"};case"size":return sm_style=t[e][1],sm_style=Math.floor(4/3*sm_style),{0:sm_style,1:sm_style+"px"};default:return{0:t[e][1],1:t[e][1]}}}};o.init()}(window,document,window.jQuery);